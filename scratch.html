<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESP32 Bluetooth Communication</title>
</head>
<body>
    <h1>ESP32 Bluetooth Communication</h1>
    <button id="connectButton">Connect to ESP32</button>
    <button id="disconnectButton" disabled>Disconnect</button>

    <div id="output"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const connectButton = document.getElementById('connectButton');
            const disconnectButton = document.getElementById('disconnectButton');
            const outputDiv = document.getElementById('output');
            let bluetoothDevice;
            let characteristic;

            connectButton.addEventListener('click', async () => {
                try {
                    bluetoothDevice = await navigator.bluetooth.requestDevice({
                        filters: [{ services: ['00001101-0000-1000-8000-00805f9b34fb'] }] // SPP service UUID
                    });

                    console.log('Connected to:', bluetoothDevice.name);

                    const server = await bluetoothDevice.gatt.connect();
                    console.log('Connected to GATT server');

                    const service = await server.getPrimaryService('00001101-0000-1000-8000-00805f9b34fb'); // SPP service UUID
                    console.log('Service discovered');

                    characteristic = await service.getCharacteristic('00001101-0000-1000-8000-00805f9b34fb'); // SPP characteristic UUID
                    console.log('Characteristic discovered');

                    // Enable notifications for the characteristic to receive data
                    await characteristic.startNotifications();

                    // Listen for data notifications
                    characteristic.addEventListener('characteristicvaluechanged', (event) => {
                        const value = event.target.value;
                        const textDecoder = new TextDecoder('utf-8');
                        const decodedValue = textDecoder.decode(value);

                        outputDiv.textContent += decodedValue;
                    });

                    connectButton.disabled = true;
                    disconnectButton.disabled = false;
                } catch (error) {
                    console.error('Bluetooth error:', error);
                }
            });

            disconnectButton.addEventListener('click', async () => {
                if (bluetoothDevice && bluetoothDevice.gatt.connected) {
                    await bluetoothDevice.gatt.disconnect();
                    console.log('Disconnected');
                }

                connectButton.disabled = false;
                disconnectButton.disabled = true;
                outputDiv.textContent = '';
            });
        });
    </script>
</body>
</html>
